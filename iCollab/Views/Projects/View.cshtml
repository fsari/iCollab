@using Core.Extensions
@using iCollab.ViewModels
@using Microsoft.AspNet.Identity
@using Model

@model iCollab.ViewModels.ProjectViewModel

@{
    ViewBag.Title = Model.Title;
}

<aside class="right-side">

    <section class="content-header">
        
    </section>

    <section class="content">
        <div class="row">
            <div class="col-md-7">
                <div class="row">
                    <div class="col-md-12">
                        <div class="box"> 
                            <div class="box-body table-responsive no-padding" style="margin-left: 10px;">
                                
                                <div class="pull-left">
                                    <h1>@Model.Title</h1>
                                    <div>
                                        Oluşturan : 
                                        @if (Model.CreatedBy.Picture != null)
                                        {
                                            <img src="@Model.CreatedBy.Picture.Path" class="img-rounded img-responsive" alt="User Image" width="30" />
                                        }
                                        else
                                        {
                                            <text>@Model.CreatedBy.UserName</text>
                                        }
                                        , 
                                        @Model.DateCreated.FormatDate()
                                    </div>
                                </div>
                                <div class="pull-right">
                                    @if (Model.Status != ProjectStatus.Bitti)
                                    {
                                        <a href="/Projects/Edit/@Model.Id"><i class="glyphicon glyphicon-edit"></i></a>
                                        <a href="/Projects/Delete/@Model.Id" onclick="return confirm('Silmek istediğinize emin misiniz?');"><i class="glyphicon glyphicon-trash btn-lg"></i></a>
                                    }
                                    <a href="/Projects/Index"><i class="glyphicon glyphicon-list btn-lg"></i></a>

                                </div>
                                <div class="clearfix"></div>

                                @Html.Raw(HttpUtility.HtmlDecode(Model.Description)) <br />

                                <div style="margin-right: 10px;">
                                    <div class="pull-left"> 
                                        <strong>Durumu : </strong> <label class="label label-info">@Model.Status </label><br />
                                        <strong>Önceliği : </strong> <label class="label label-primary">@Model.Priority </label><br />

                                        <strong>Kullanıcılar :</strong> 
                                        @foreach (var user in Model.SelectedUsers)
                                        {
                                            <label class="label label-default">  @user </label>
                                        }
                                        
                                    </div>
                                    <div class="pull-right">
                                        <strong>Oluşturulma Zamanı : </strong> @Html.DisplayFor(model => model.DateCreated) <br />
                                        
                                        @if (Model.StartDatetime.HasValue)
                                        {
                                            <strong>Başlangıç : </strong> @Html.DisplayFor(model => model.StartDatetime) <br />
                                        }
                                        
                                        @if (Model.EndDatetime.HasValue)
                                        {
                                            <strong>Bitiş : </strong> @Html.DisplayFor(model => model.EndDatetime) <br />
                                        } 
                                    </div>

                                    <div class="clearfix"></div>
                                </div>

                                <div class="clearfix"></div>

                                <div> 
                                    <div class="pull-left">
                                        @if (Model.PreviousProject != null)
                                        {
                                            <a href="/Projects/View/@Model.PreviousProject.Id" class="btn btn-primary btn-sm">@Model.PreviousProject.Title</a>
                                        }

                                        @if (Model.NextProject != null)
                                        {
                                            <a href="/Projects/View/@Model.NextProject.Id" class="btn btn-primary btn-sm">@Model.NextProject.Title</a>
                                        }
                                    </div>
                                    <div class="pull-right">
                                        @if (Model.CreatedBy.UserName == User.Identity.GetUserName() && (Model.Status != ProjectStatus.Bitti || Model.Status != ProjectStatus.Iptal))
                                        {
                                            @Html.ActionLink("Projeyi Bitir", "Finish", new { id = Model.Id }, new { @class = "btn btn-danger btn-sm", onclick = "return confirm('Projeyi bitirmek istediginizden emin misiniz?');" })
                                            @Html.ActionLink("Projeyi iptal et", "CancelProject", new { id = Model.Id }, new { @class = "btn btn-warning btn-sm", onclick = "return confirm('Projeyi iptal etmek istediginizden emin misiniz?');" })
                                        }
                                    </div>
                                    <div class="clearfix"></div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-header">
                                <i class="fa fa-tasks"></i>
                                <h3 class="box-title">Proje Görevleri</h3>

                                <div class="pull-right box-tools">
                                    @Html.ActionLink("Görev Ekle", "AddTask", "Projects", new { projectId = Model.Id }, new { @class = "btn btn-danger btn-sm" })
                                </div>
                            </div>
                            <div class="box-body">
                                @if (Model.Tasks != null)
                                {
                                    if (Model.Tasks.Any() == false)
                                    {
                                        <div class="callout">
                                            Bu projeye ait bir görev yok.
                                        </div>
                                    }
                                    else
                                    {
                                        { Html.RenderPartial("_TaskTable", Model.Tasks); }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div> 

                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-header">
                                <i class="fa fa-book"></i>
                                <h3 class="box-title">Proje Dökümanları</h3>

                                <div class="pull-right box-tools">
                                    @Html.ActionLink("Döküman Ekle", "AddDocument", "Projects", new { projectId = Model.Id }, new { @class = "btn btn-danger btn-sm" })
                                </div>
                            </div>
                            <div class="box-body"> 
                                @if (Model.Documents != null)
                                {
                                    if (Model.Documents.Any() == false)
                                    {
                                        <div class="callout">
                                            Bu projeye ait bir doküman yok.
                                        </div>
                                    }
                                    else
                                    {
                                        { Html.RenderPartial("_DocumentTable", Model.Documents); }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div> 
            </div>

            <div class="col-md-5">
                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-body">
                                @{Html.RenderPartial("_Attachment", new AttachmentViewModel
                                  {
                                      Attachments = Model.Attachments,
                                      UploadPath = "/Projects/Upload/?id=" + Model.Id,
                                      RemovePath = "/Projects/RemoveAttachment/?projectId=" + Model.Id
                                  });}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-header">
                                <i class="fa fa-book"></i>
                                <h3 class="box-title">Proje toplantıları</h3>
                                <div class="pull-right box-tools">
                                    @Html.ActionLink("Toplantı Ekle", "AddMeeting", "Projects", new { projectId = Model.Id }, new { @class = "btn btn-danger btn-sm" })
                                </div>
                            </div>
                            <div class="box-body">
                                @if (Model.Meetings != null)
                                {
                                    if (Model.Meetings.Any() == false)
                                    {
                                        <div class="callout">
                                            Bu projeye ait bir toplantı yok.
                                        </div>
                                    }
                                    else
                                    {
                                        { Html.RenderPartial("_MeetingTable", Model.Meetings); }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div> 

        </div>
    </section>
</aside>

