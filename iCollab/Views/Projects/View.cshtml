@using iCollab.ViewModels
@using Microsoft.AspNet.Identity
@using Model

@model iCollab.ViewModels.ProjectViewModel

@{
    ViewBag.Title = Model.Title;
}

<aside class="right-side">

    <section class="content-header">
        <h1 class="pull-left">@Model.Title</h1>
        <div class="pull-right">
            @if (Model.Status != ProjectStatus.Bitti)
            {
                @Html.ActionLink("Düzenle", "Edit", new { id = Model.Id }, new { @class = "btn btn-primary btn-sm" })
                @Html.ActionLink("Sil", "Delete", "Projects", new { id = Model.Id }, new { @class = "btn btn-info btn-sm", onclick = "return confirm('Silmek istediğinize emin misiniz?');" })
            }

            @Html.ActionLink("Tüm Projeler", "Index", "Projects", new { id = Model.Id }, new { @class = "btn btn-success btn-sm" })
        </div>
        <div class="clearfix"></div>
    </section>

    <section class="content">
        <div class="row">
            <div class="col-md-7">
                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-body table-responsive no-padding" style="margin-left: 10px;">

                                @Html.Raw(HttpUtility.HtmlDecode(Model.Description)) <br />

                                <div style="margin-right: 10px;">
                                    <div class="pull-left">
                                        <strong>Oluşturan : </strong><label class="label label-success"> @Model.CreatedBy</label><br />
                                        <strong>Durumu : </strong> <label class="label label-info">@Model.Status </label><br />
                                        <strong>Önceliği : </strong> <label class="label label-primary">@Model.Priority </label><br />

                                        <strong>Kullanıcılar :</strong>
                                        
                                    </div>
                                    <div class="pull-right">
                                        <strong>Oluşturulma Zamanı : </strong> @Html.DisplayFor(model => model.DateCreated) <br />
                                        <strong>Başlangıç : </strong> @Html.DisplayFor(model => model.StartDatetime) <br />
                                        <strong>Bitiş : </strong> @Html.DisplayFor(model => model.EndDatetime) <br />
                                    </div>

                                    <div class="clearfix"></div>
                                </div>

                                <div style="margin: 10px;">
                                    @if (Model.CreatedBy == User.Identity.GetUserName() && (Model.Status != ProjectStatus.Bitti || Model.Status != ProjectStatus.Iptal))
                                    {
                                        @Html.ActionLink("Projeyi Bitir", "Finish", new { id = Model.Id }, new { @class = "btn btn-danger btn-sm", onclick = "return confirm('Projeyi bitirmek istediginizden emin misiniz?');" })
                                        @Html.ActionLink("Projeyi iptal et", "CancelProject", new { id = Model.Id }, new { @class = "btn btn-warning btn-sm", onclick = "return confirm('Projeyi iptal etmek istediginizden emin misiniz?');" })
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-header">
                                <i class="fa fa-tasks"></i>
                                <h3 class="box-title">Proje Görevleri</h3>

                                <div class="pull-right box-tools">
                                    @if (ViewBag.IsManager && (Model.Status != ProjectStatus.Bitti && Model.Status != ProjectStatus.Iptal))
                                    {
                                        @Html.ActionLink("Görev Ekle", "AddTask", "Projects", new { projectId = Model.Id }, new { @class = "btn btn-danger btn-sm" })
                                    }
                                </div>
                            </div>
                            <div class="box-body">
                                @if (Model.Tasks != null)
                                {
                                    if (Model.Tasks.Any() == false)
                                    {
                                        <div class="callout">
                                            Bu projeye ait bir görev yok.
                                        </div>
                                    }
                                    else
                                    {
                                        { Html.RenderPartial("_TaskTable", Model.Tasks); }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div> 

                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-header">
                                <i class="fa fa-book"></i>
                                <h3 class="box-title">Proje Dökümanları</h3>

                                <div class="pull-right box-tools">
                                    @if (ViewBag.IsManager)
                                    {
                                        @Html.ActionLink("Döküman Ekle", "AddDocument", "Projects", new { projectId = Model.Id }, new { @class = "btn btn-danger btn-sm" })
                                    }
                                </div>
                            </div>
                            <div class="box-body">

                                @if (Model.Documents != null)
                                {
                                    if (Model.Documents.Any() == false)
                                    {
                                        <div class="callout">
                                            Bu projeye ait bir doküman yok.
                                        </div>
                                    }
                                    else
                                    {
                                        { Html.RenderPartial("_DocumentTable", Model.Documents); }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div> 
            </div>

            <div class="col-md-5">
                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-body">
                                @{Html.RenderPartial("_Attachment", new AttachmentViewModel
                                  {
                                      Attachments = Model.Attachments,
                                      UploadPath = "/Projects/Upload/?id=" + Model.Id,
                                      RemovePath = "/Projects/RemoveAttachment/?projectId=" + Model.Id
                                  });}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="box">
                            <div class="box-header">
                                <i class="fa fa-book"></i>
                                <h3 class="box-title">Proje toplantıları</h3>
                                <div class="pull-right box-tools">
                                    @Html.ActionLink("Toplantı Ekle", "AddMeeting", "Projects", new { projectId = Model.Id }, new { @class = "btn btn-danger btn-sm" })
                                </div>
                            </div>
                            <div class="box-body">
                                @if (Model.Meetings != null)
                                {
                                    if (Model.Meetings.Any() == false)
                                    {
                                        <div class="callout">
                                            Bu projeye ait bir toplantı yok.
                                        </div>
                                    }
                                    else
                                    {
                                        { Html.RenderPartial("_MeetingTable", Model.Meetings); }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div> 

        </div>
    </section>
</aside>

